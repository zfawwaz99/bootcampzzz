/// <reference types="cypress" />

describe('Login feature', () => {
    // Verify the login page loads correctly
    it('Verify Login Page Loads Correctly', () => {
        cy.visit('https://opensource-demo.orangehrmlive.com/web/index.php/auth/login');
        cy.get('.oxd-text.oxd-text--h5.orangehrm-login-title').should('have.text', 'Login');
    });

    // Verify User Login with Valid Credentials
    it('User Login with Valid Credentials', () => {
        cy.visit('https://opensource-demo.orangehrmlive.com/web/index.php/auth/login');
        cy.get('[name="username"]').type('Admin');
        cy.get('[name="password"]').type('admin123');
        cy.intercept("GET", "**/api/v2/dashboard/employees/action-summary").as("actionSummary");
        cy.get('.oxd-button.oxd-button--medium.oxd-button--main.orangehrm-login-button').click();
        
        cy.wait("@actionSummary").then((intercept) => {
            // Verifikasi status response dari intercept
            expect(intercept.response.statusCode).to.equal(200);
        });

        // Verifikasi halaman dashboard
        cy.get('.oxd-text.oxd-text--h6.oxd-topbar-header-breadcrumb-module').should('have.text', 'Dashboard');
        cy.url().should('include', '/web/index.php/dashboard/index');
        cy.get('.oxd-text.oxd-text--h6.oxd-topbar-header-breadcrumb-module').should('exist');
    });

    // Verify Login with Invalid Credentials
    it('User Login with Invalid Credentials', () => {
        cy.visit('https://opensource-demo.orangehrmlive.com/web/index.php/auth/login');
        cy.get('[name="username"]').type('InvalidUser');
        cy.get('[name="password"]').type('InvalidPassword');
        cy.get('.oxd-button.oxd-button--medium.oxd-button--main.orangehrm-login-button').click();

        // Verifikasi pesan error
        cy.get('.oxd-alert-content').should('have.text', 'Invalid credentials');
    });
});
